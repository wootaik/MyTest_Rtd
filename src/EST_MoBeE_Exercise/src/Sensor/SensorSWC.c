/**
 * @defgroup SensorSWC SensorSWC
 * @{
 */

/******************************************************************************/
/**
 * @file         SensorSWC.c
 *
 * @brief        The source of Sensor software component
 *
 * @version 0.9  @date Jul/03/2008
 * @author       KyeongJin, Lee 
 * @warning
 * @bug
 * @note
 * <pre>
 * ---------------------------------------------------------------------------
 *               R E V I S I O N   H I S T O R Y
 * ---------------------------------------------------------------------------
 *   Date        Version  Author     Description
 *  ----------   -------  ---------  -----------------------------------------
 *  2008-07-03   0.90     KyeongJin  - Creation  Prerelease
 * </pre>
 *
 */
/******************************************************************************/

#ifndef __SENSORSWC_C__
#define __SENSORSWC_C__

/******************************************************************************/
/******************************************************************************/
/*                           MODULES USED                                     */
/******************************************************************************/
/******************************************************************************/
#include "SensorSWC.h"
#include "Hal.h"


/******************************************************************************/
/******************************************************************************/
/*                           DEFINITIONS AND MACROS                           */
/******************************************************************************/
/******************************************************************************/



/******************************************************************************/
/******************************************************************************/
/*                           TYPEDEFS AND STRUCTURES                          */
/******************************************************************************/


/******************************************************************************/
/******************************************************************************/
/*                           PROTOTYPES OF LOCAL FUNCTIONS                    */
/******************************************************************************/
/******************************************************************************/


/******************************************************************************/
/******************************************************************************/
/*                           STATIC VARIABLES                                 */
/******************************************************************************/
/******************************************************************************/

STATIC int16_t i16SupplyVoltage;
STATIC enuMsbCommand_t enuCommand;
STATIC int16_t i16BeltTension;
STATIC int16_t i16MotorCurrent;

/******************************************************************************/
/******************************************************************************/
/*                           LOCAL FUNCTIONS                                  */
/******************************************************************************/
/******************************************************************************/


/******************************************************************************/
/******************************************************************************/
/*                           EXPORTED FUNCTIONS                               */
/******************************************************************************/
/******************************************************************************/

int16_t GetSupplyVoltage(void)
{
	//s16SupplyVoltageActual = .......
	return(i16SupplyVoltage);
}

enuMsbCommand_t GetCommand(void)
{
	return(enuCommand);
}

int16_t GetBeltTension(void)
{
	return(i16BeltTension);
}


void ReceiveCommand(void)
{
	enuCommand = Hal_MsbCommand;
}



void MeasureSupplyVoltage(void)
{
	uint16_t adc_supply_voltage;

	/* Call adc result in HAL */
	// adc_supply_voltage = ...

	/* Calc i16SupplyVoltage */
	// i16SupplyVoltage = ...

	/* Filtering, if necessary*/
	//i16SupplyVoltage = .....
}



void MeasureBeltTension(void)
{

	i16MotorCurrent = SCALE_MOTOR_CURRENT*Adc_GetData(MOTOR_CUR_CHANNEL);
	if(i16MotorCurrent < SCALE_CURRENT_TENSION_OFFSET){
		i16BeltTension = 0;
	}else {
		i16BeltTension = (SCALE_CURRENT_TENSION_NUM * (i16MotorCurrent - SCALE_CURRENT_TENSION_OFFSET)) / SCALE_CURRENT_TENSION_DEN ;
	}
}
  
  

void InitSensor(void)
{
	i16SupplyVoltage = 0;
	enuCommand = CMD_UNDEFINED;
	i16BeltTension = 0;
}

#endif

/******************************************************************************/
/*                                                                            */
/*                            EOF                                             */
/*                                                                            */
/******************************************************************************/

/** @} */
